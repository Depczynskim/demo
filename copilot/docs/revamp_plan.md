# Pops Analytics Copilot â€“ Revamp Roadmap

> Last updated: <!--KEEP-THIS-LINE-->2025-06-15

This living document tracks the end-to-end refactor that will turn the Copilot from a basic report generator into a fully-fledged, context-aware growth assistant.

---

## âœ… Progress checklist

- [x] 0 â€“ Baseline tests in place (pytest suite green)
- [x] 1 â€“ Structured summary layer (`*.json` alongside `*.md`)
-     - Completed for GA4, Google Ads, Search Console
-
> Note: **All Copilot-generated artefacts (summaries, vector store, etc.) now live inside the `copilot/` directory tree** to keep the root clean and portable.
- [x] 2 â€“ Aggregate context builder
-    - `combined_summary_{30|90|365}d.(md|json)` generated from joined daily fact-table
-    - `build_context.py` merges GA4, Ads, SC & Combined JSONs into `context_{window}.json`
- [x] 3 â€“ Prompt-engineering revamp (template builder merged)
- [x] 4 â€“ Persistent chat memory (SQLite/DuckDB)
- [x] 5 â€“ Session-level analytics & intent modelling
-    - `build_session_df` derives `engagement_level` (1â€“6) and persists `sessions_latest.parquet`.
-    - Introduced *Level-5 intent* definition (add_to_cart, view_cart, form_start, begin_checkout).
-    - Pipeline lives in `copilot/utils/session_extractor.py`.
- [x] 6 â€“ Google Ads integration update
-    - `google_ads_summary.py` now counts Level-5 sessions, adds `l5_sessions` & `cost_per_l5`.
- [x] 7 â€“ Combined summary overhaul
-    - Deprecated joined parquet; `combined_summary.py` now reads individual JSON summaries.
-    - New fields: `ads_l5_sessions`, `ads_cost_per_l5`.
- [x] 8 â€“ Prompt templates & longer-form report generation
-    - Fixed 4-section `system_prompt.jinja` and enriched `user_prompt.jinja`.
-    - Streamlit report view passes both Markdown **and** JSON context; `max_tokens` raised to 2 000.
-
> Note: **All Copilot-generated artefacts (summaries, vector store, etc.) now live inside the `copilot/` directory tree** to keep the root clean and portable.
- [ ] 9 â€“ Pinterest data pipeline _(paused â€“ awaiting dev account)_
- [ ] 10 â€“ LLM-initiated data requests _(backlog)_
- [ ] 11 â€“ Evaluation harness
- [ ] 12 â€“ Docs & Makefile targets

Check an item once the related PR or commit lands and tests pass.

---

## Detailed steps

### 0 â€“ Project baseline (0.5 d)
Establish a green baseline:
1. Add pytest workflow.
2. Smoke-test Streamlit views with sample parquet files.

### 1 â€“ Structured summaries (1 d)
Goal: Each summarisation script writes BOTH human markdown **and** machine-readable JSON with the exact metrics.

Deliverables:
- New `copilot/summaries/{source}_summary_{window}.json` files.
- Updated unit tests verifying key fields.

### ðŸš§ Next Active Workstream

With the core analytics layers in place, the focus now shifts to **12 â€“ Docs & Makefile targets** â€“ tightening developer DX and adding scripted entry-points.

Objectives (Jun 27 â€“ Jun 30):
1. Write concise setup & contribution docs for Copilot additions.  
2. Add `make` targets: `make dev`, `make test`, `make lint`, `make vector-index`.  
3. Ensure `.env.example` is up-to-date with all new vars (memory DB, suggestion model).  
4. Polish internal code docs (module-level docstrings) where missing.

Owner: @copilot-team â€“ target PR by 2025-06-30.

---

## ðŸ“Š Key Analytical Findings (Mar â€“ Jun 2025)

1. **Conversion scarcity** â€“ The GA-4 export contained only *two* `purchase` events for the period.
2. **Level-5 intent sessions** â€“ Using high-intent events *(add_to_cart, view_cart, form_start, begin_checkout)* we identified **134 sessions** signalling strong purchase intent.
3. **Lift analysis** â€“ Compared to the overall population, the following signals correlate with Level-5 intent:
   - FAQ clicks: **5.3 Ã—** lift
   - Gallery clicks: **2.7 Ã—** lift
   - â‰¥ 3 pageviews: **1.5 Ã—** lift
   - On-site search: **negative** signal (âˆ’0.7 Ã—)
4. **Logistic regression model** *(AUC 0.84)* â€“ Top predictors:
   â€¢ `traffic_medium=cpc`
   â€¢ Tablet devices
   â€¢ FAQ / gallery click counts
   â€¢ UK & PL traffic
5. **Google Ads impact** â€“ Campaign-level estimates for Level-5 sessions now power *cost per L5* metrics, exposing under-performing ad groups.

These insights directly inform the recommendation section in the Copilot's autogenerated reports and will guide the upcoming optimisation roadmap.

<!-- Continue with the plan; truncated for brevity --> 